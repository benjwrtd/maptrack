<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>



        br{
            display: block;
            margin: 1px 0;
        }
        h4 {
            text-align: left;
        }
        .buttontoy{
            background-color: #0d91dd;
            transition-duration: 0.2s;
            border: groove 1px rgb(77, 72, 72);
            cursor:pointer;


        }
        .buttontoy:hover{
        background-color: #7e837e; /* Green */
         border: groove 1px rgb(77, 72, 72);
         cursor:pointer            
        }
        .buttonpeug{
            background-color: #0d91dd;
            transition-duration: 0.2s;
            border: groove 1px rgb(77, 72, 72);
            cursor:pointer;


        }
        .buttonpeug:hover{
        background-color: #7e837e; /* Green */
         border: groove 1px rgb(77, 72, 72);
         cursor:pointer            
        }

        .buttonhi {
            background-color: #4CAF50;
            transition-duration: 0.2s;
            border: groove 1px rgb(77, 72, 72);
            cursor:pointer;

        }

        .buttonhi:hover {
         background-color: #7e837e; /* Green */
         border: groove 1px rgb(77, 72, 72);
         cursor:pointer
        
        }
        .buttonmed {
            background-color: #ff9100;
            transition-duration: 0.2s;
            border: groove 1px rgb(77, 72, 72);
            cursor:pointer
        }

        .buttonmed:hover {
         background-color: #7e837e; /* Green */
         border: groove 1px rgb(77, 72, 72);
         cursor:pointer
        
        }
        .buttonlow {
            background-color: #f44336;
            transition-duration: 0.2s;
            border: groove 1px rgb(77, 72, 72);
            cursor:pointer
        }

        .buttonlow:hover {
         background-color: #7e837e; /* Green */
         border: groove 1px rgb(77, 72, 72);
         cursor:pointer
        
        }
        

    </style>


</head>
<body style="background-color:#242526;">
    <div id='container' style='width:100%;'>
        <div id="leftside" style="width: 20%;">

            <input style="width: 99%;float: left;"id="searchbar" onkeyup="search()" type="text"name='search'placeholder='Search'></input>



        <div id='table'class='left' style='height:50vh;width:100%;float:left;border:4px solid rgb(49, 55, 63);overflow: auto;'>
            <ol style="height:100%;list-style-type: none;padding-left: 0;" id="list">
            </ol>
        </div>

        <div style='height:25.4vh;width:100%;float:left;border:4px solid rgb(49, 55, 63);overflow: auto;'>
        </div>


        </div>





        <div id="map" class='center' style='height:98vh;width: 79%;border:4px solid rgb(49, 55, 63);box-sizing: border-box;'>
        </div>
        </div>
    



    <script>
        var jsondata = {
            fleet:[],
            cctv:[]
        };
        function initMap() {
            
            var mapOptions = {
                center: new google.maps.LatLng('53.260990','-1.350890'),
                zoom: 10
            }
            let map = new google.maps.Map(document.getElementById('map'),mapOptions);


            //CCTV MARKERS & INFO
        var cctvburl = "https://login.trackit247.com/api/";
        var cctvquery = 'api/ThirdParty/RequestLocation?AccountName=roadsidecctv&AccountPassword=R04dside114!&GetAll=True';
        var cctvreq = new XMLHttpRequest();
        cctvreq.open('get',cctvburl+cctvquery,true);
        cctvreq.onload = function(){
            for (var cctvinfo of JSON.parse(cctvreq.responseText)){
                //onsole.log(cctvreq.responseText);
            var cctvicon;
            var cctvclass;

            if (parseFloat(cctvinfo['BatteryLevel']) >= 12){
                cctvicon = 'https://raw.githubusercontent.com/benjwrtd/anprcarparksolution/main/CCTVHI_1_65.png'
                cctvclass = 'buttonhi'
            } else if (parseFloat(cctvinfo['BatteryLevel']) > 11.50 && parseFloat(cctvinfo['BatteryLevel'])<12 ){
                cctvicon = 'https://raw.githubusercontent.com/benjwrtd/maptrack/main/CCTVMED_65.png'
                cctvclass = 'buttonmed'
            }else {
                cctvicon = 'https://raw.githubusercontent.com/benjwrtd/maptrack/main/CCTVLOW_65.png'
                cctvclass = 'buttonlow'}
            jsondata.cctv.push({
                "Registration" : cctvinfo['Registration'],
                "Lat" : cctvinfo['Lat'],
                "Lon" : cctvinfo['Lon'],
                "BatteryLevel" : cctvinfo['BatteryLevel'],
                "Address" :  cctvinfo['Address'],
                "CCTVClass" : cctvclass,
                "CCTVIcon"  : cctvicon

            })}
            
        };
        cctvreq.send();

            console.log(jsondata);

            //console.log(cctvreg,cctvlat,cctvlon,cctvbattery)

            var infowindow = new google.maps.InfoWindow();


            var cctvmarker, i;

            cctvmarker = new google.maps.Marker({
                position: new google.maps.LatLng(cctvlat, cctvlon),
                map: map,
                label: { color: '#000000', fontWeight: 'bold', fontSize: '9px', text: cctvreg },
                icon: cctvicon
            });
            console.log(cctvclass)
            document.getElementById('list').innerHTML += '<li><button class="'+cctvclass+'"'+'data-lat="'+cctvlat+'" data-lon="'+cctvlon+'"'+'"><div style="position: absolute;top: 10px;left: 10px;font-size: 7px;color: rgb(61, 52, 52);" ></div><div style="text-align: left;font-size: 12px;"><img src="https://raw.githubusercontent.com/benjwrtd/maptrack/main/cctvlogo.png"><br></br><b>Asset Name: </b>'+cctvreg+'<br><b>Address: </b>'+cctvaddress+'</br><br><b>Battery Level: </b>'+cctvbattery+'</br></div></button></li>';
            

            google.maps.event.addListener(cctvmarker, 'click', (function(cctvmarker,cctvreg,cctvbattery) {
                return function() {
                infowindow.setContent('<div><b>CCTV Name: </b>'+cctvreg+'<br><b>Battery Level: </b>'+cctvbattery+'</br>'+'</div>');
                infowindow.open(map, cctvmarker);
                }
            })(cctvmarker, cctvreg,cctvbattery));

            google.maps.event.addListener(cctvmarker, 'click', (function(cctvmarker,cctvlat,cctvlon) {
                return function() {
                map.setCenter(new google.maps.LatLng(cctvlat, cctvlon));
                console.log(cctvlat,cctvlon)
                }
            })(cctvmarker, cctvlat,cctvlon));

            document.querySelector(".left").addEventListener("click", event =>{
                map.setCenter(new google.maps.LatLng(event.target.closest("[data-lat]").dataset.lat, event.target.closest("[data-lon]").dataset.lon),22)
                map.setZoom(16);


            });


            
        


            }
            cctvreq.send();

            let cars = ['Peugeot HX19 DVL','Peugeot HX70BWN','Hilux YT69YHK','Hilux YT69 YHJ'];
            var fleetburl = "https://fleet.trackit247.com/api/";
            var fleetquery = 'api/GateHouse/RequestLocation?AccountName=roadsidetech&APIKEY=9dd5600b-f314-436e-abf7-b5eb43dec19d';
            var fleetquery2 = 'api/PanelApp/Login?AccountName=ROADSIDETECH&AccountUsername=admin&AccountPassword=password'
            var fleetreq = new XMLHttpRequest();
            fleetreq.open('get',fleetburl+fleetquery,true);
            fleetreq.onload = function(){
                console.log(fleetreq.responseText)
                for (var fleetinfo of JSON.parse(fleetreq.responseText)){
                    if (cars.includes(fleetinfo['Registration']) == true){
                        fleetreg = fleetinfo['Registration'];
                        fleetlat = fleetinfo['Lat']
                        fleetlon = fleetinfo['Lon']
                        var fleetinfowindow = new google.maps.InfoWindow();
                        var fleetmarker, i;
                        var fleeticon;
                        if (fleetreg.includes('Peugeot') == true){
                fleeticon = 'https://raw.githubusercontent.com/benjwrtd/maptrack/main/FLEETPEUG_65.png'
                fleetclass = 'buttonpeug'
                fleetbuttonico = 'https://raw.githubusercontent.com/benjwrtd/maptrack/main/iconpeug.png'
                     } else {
                fleeticon = 'https://raw.githubusercontent.com/benjwrtd/maptrack/main/FLEETTOY_65.png'
                fleetclass = 'buttontoy'
                fleetbuttonico = 'https://raw.githubusercontent.com/benjwrtd/maptrack/main/icontoy.png'
                }   
                document.getElementById('list').innerHTML += '<button class="'+fleetclass+'"'+'data-lat="'+fleetlat+'" data-lon="'+fleetlon+'"'+'style="width: 100%;"><div style="text-align: left;font-size: 12px;"><br><img src="'+fleetbuttonico+'"></br><b>Asset Name: </b>'+fleetreg+'<br><b>Address: </b>'+'test'+'</br><br><b>Battery Level: </b>'+'test'+'</br></div></button>';

                fleetmarker = new google.maps.Marker({
                position: new google.maps.LatLng(fleetlat, fleetlon),
                map: map,
                label: { color: '#FFFFFF', fontWeight: 'bold', fontSize: '9px', text: fleetreg },
                icon: fleeticon
                
            });
            google.maps.event.addListener(fleetmarker, 'click', (function(fleetmarker,fleetreg,) {
                return function() {
                fleetinfowindow.setContent('<div><b>CCTV Name: </b>'+fleetreg+'<br><b>Battery Level: </b>'+'</br>'+'</div>');
                fleetinfowindow.open(map, fleetmarker);
                }
            })(fleetmarker, fleetreg));

            document.querySelector(".left").addEventListener("click", event =>{
                map.setCenter(new google.maps.LatLng(event.target.closest("[data-lat]").dataset.lat, event.target.closest("[data-lon]").dataset.lon),22)
                map.setZoom(16);


            });
            
            







                    }

            }
            









        }
        fleetreq.send();

    

    function search(){
    let input = document.getElementById('searchbar').value
    input=input.toLowerCase();
    let table = document.getElementById("leftside").querySelectorAll('.buttonhi,.buttonlow,.buttonmed')
    console.log(table)
    for (i=0; i < table.length; i++) {
        if (!table[i].innerHTML.toLowerCase().includes(input)){
            table[i].style.display="none";
        }
        else {
            table[i].style.display="list-item";
        }

    }
    
}
   
    </script>    


    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDclbTLYa_9Y0QN2IrSqiHzezSBGJSWHgs&callback=initMap"></script>



</body>
</html>

